<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DRIVE PREMIUM | Rolex Edition</title>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- –Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞ API -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=–≤–∞—à-–∫–ª—é—á&lang=ru_RU" type="text/javascript"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --rolex-green: #006039;
            --rolex-gold: #956B3E;
            --rolex-cream: #F5F0E6;
            --rolex-silver: #C0C0C0;
            --rolex-dark: #1A1A1A;
            --rolex-light: #FAF7F2;
            --bg-gradient: linear-gradient(145deg, #F5F0E6 0%, #E8E0D5 100%);
            --text-primary: #1A1A1A;
            --text-secondary: #4A4A4A;
            --text-muted: #8A8A8A;
            --border-light: rgba(149, 107, 62, 0.2);
            --shadow-premium: 0 20px 40px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(149, 107, 62, 0.1);
            --font-main: 'Inter', 'Helvetica Neue', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDgwIDgwIj48cGF0aCBkPSJNNDAgMjBhMjAgMjAgMCAwIDEgMjAgMjAgMjAgMjAgMCAwIDEtMjAgMjAgMjAgMjAgMCAwIDEtMjAtMjAgMjAgMjAgMCAwIDEgMjAtMjB6IiBmaWxsPSIjOTU2QjNFIiBmaWxsLW9wYWNpdHk9IjAuMDMiLz48L3N2Zz4=') repeat;
            pointer-events: none;
        }

        .app {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            position: relative;
        }

        /* ===== –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ ===== */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* –ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä */
        .plate-rolex {
            background: white;
            border-radius: 8px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(149, 107, 62, 0.2);
            position: relative;
        }

        .plate-number {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: 2px;
            color: var(--text-primary);
            font-family: 'Helvetica', sans-serif;
        }

        .plate-rus {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #1B3B6A;
            padding: 4px 12px;
            border-radius: 4px;
            color: white;
            font-size: 14px;
            font-weight: 500;
        }

        /* –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .spec-card {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-premium);
        }

        .spec-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 30px rgba(149, 107, 62, 0.1);
        }

        .spec-label {
            color: var(--rolex-gold);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .spec-value {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 500;
        }

        /* VIN */
        .vin-rolex {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .vin-label {
            color: var(--rolex-gold);
            font-size: 12px;
            text-transform: uppercase;
        }

        .vin-value {
            font-family: 'Courier New', monospace;
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn-rolex {
            background: var(--rolex-green);
            color: white;
            border: none;
            border-radius: 40px;
            padding: 16px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 0 #003F26, 0 10px 20px rgba(0, 96, 57, 0.2);
        }

        .btn-rolex:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 0 #003F26, 0 15px 30px rgba(0, 96, 57, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--rolex-gold);
            color: var(--rolex-gold);
            padding: 14px 24px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-outline:hover {
            background: var(--rolex-gold);
            color: white;
        }

        /* –ü–æ–≥–æ–¥–∞ */
        .weather-rolex {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-premium);
        }

        .weather-main {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .weather-icon {
            font-size: 48px;
        }

        .weather-temp {
            font-size: 36px;
            font-weight: 600;
            color: var(--rolex-green);
        }

        .weather-city {
            color: var(--rolex-gold);
            font-size: 14px;
        }

        .weather-recommendation {
            margin-top: 15px;
            padding: 12px 16px;
            background: var(--rolex-cream);
            border-radius: 12px;
            font-size: 14px;
            color: var(--text-primary);
        }

        /* –î–æ–∫—É–º–µ–Ω—Ç—ã */
        .docs-rolex {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 24px;
            padding: 20px;
            box-shadow: var(--shadow-premium);
        }

        .docs-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .docs-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--rolex-green);
            font-weight: 600;
        }

        .doc-item {
            background: var(--rolex-cream);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .doc-actions {
            display: flex;
            gap: 8px;
        }

        .doc-actions button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--rolex-gold);
            font-size: 16px;
        }

        .password-field {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .password-field input {
            flex: 1;
            padding: 14px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-size: 14px;
        }

        /* ===== –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ ===== */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-rolex {
            display: flex;
            gap: 8px;
            background: white;
            padding: 8px;
            border-radius: 50px;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-premium);
        }

        .nav-btn {
            flex: 1;
            padding: 14px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .nav-btn:hover {
            color: var(--rolex-gold);
        }

        .nav-btn.active {
            background: var(--rolex-green);
            color: white;
        }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tab {
            display: none;
            animation: fadeScale 0.4s ease;
        }

        .tab.active {
            display: block;
        }

        @keyframes fadeScale {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .content-card {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 30px;
            padding: 30px;
            box-shadow: var(--shadow-premium);
        }

        /* –ü–æ–∏—Å–∫ */
        .search-rolex {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-light);
            border-radius: 16px;
            font-size: 15px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .search-rolex:focus {
            border-color: var(--rolex-gold);
            outline: none;
        }

        .search-results {
            max-height: 500px;
            overflow-y: auto;
        }

        .search-result-item {
            padding: 16px;
            background: var(--rolex-cream);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
            border-left: 4px solid transparent;
        }

        .search-result-item:hover {
            border-left-color: var(--rolex-gold);
            transform: translateX(5px);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 9998;
        }

        .modal-rolex {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 30px;
            padding: 30px;
            z-index: 9999;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-rolex.active {
            display: block;
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        /* –ú–æ–π–∫–∞ */
        .wash-form {
            display: grid;
            gap: 15px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            background: var(--rolex-cream);
            padding: 15px;
            border-radius: 16px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--rolex-green);
        }

        .photo-upload {
            border: 2px dashed var(--rolex-gold);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload:hover {
            background: var(--rolex-cream);
        }

        .wash-previews {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .wash-previews img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 12px;
            border: 2px solid var(--rolex-gold);
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border-left: 4px solid var(--rolex-green);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideUp 0.3s ease;
            z-index: 10000;
            min-width: 300px;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        .stat-card {
            background: var(--rolex-cream);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--rolex-green);
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 900px) {
            .app {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="notifications-container" id="notifications" style="position: fixed; bottom: 30px; right: 30px; z-index: 9999;"></div>

    <div class="app">
        <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
        <div class="left-panel">
            <!-- –ì–æ—Å–Ω–æ–º–µ—Ä (–Ω–∞—Å—Ç–æ—è—â–∏–π –†–§) -->
            <div class="plate-rolex">
                <span class="plate-number" id="plateNumber">A 123 AA</span>
                <div class="plate-rus">
                    <span>üá∑üá∫</span>
                    <span id="plateRegion">77 RUS</span>
                </div>
            </div>

            <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
            <div class="specs-grid" id="carInfo"></div>

            <!-- VIN -->
            <div class="vin-rolex">
                <span class="vin-label">VIN</span>
                <span class="vin-value" id="vinNumber">WBANX123456789012</span>
                <button onclick="openEditCarModal()" style="background:none; border:none; color:var(--rolex-gold); cursor:pointer;">‚úèÔ∏è</button>
            </div>

            <!-- –ü–æ–≥–æ–¥–∞ –Ø–Ω–¥–µ–∫—Å -->
            <div class="weather-rolex" id="weatherWidget">
                <div class="weather-main">
                    <span class="weather-icon" id="weatherIcon">‚òÄÔ∏è</span>
                    <div>
                        <div class="weather-temp" id="weatherTemp">--¬∞C</div>
                        <div class="weather-city" id="weatherCity">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                <div class="weather-recommendation" id="weatherAdvice"></div>
            </div>

            <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
            <div class="docs-rolex">
                <div class="docs-header">
                    <div class="docs-title">
                        <span>üîí</span>
                        <span>–î–æ–∫—É–º–µ–Ω—Ç—ã</span>
                    </div>
                    <span style="color: var(--text-muted);" id="docStatus">(–∑–∞–∫—Ä—ã—Ç–æ)</span>
                </div>

                <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è -->
                <div id="noPassword" style="display: none;">
                    <div style="padding:20px; background:var(--rolex-cream); border-radius:16px;">
                        <h4 style="margin-bottom:15px;">üîê –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å</h4>
                        <div class="password-field">
                            <input type="password" id="newPassword" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                            <button class="btn-rolex" onclick="createPassword()" style="padding:14px 20px;">–°–æ–∑–¥–∞—Ç—å</button>
                        </div>
                    </div>
                </div>

                <!-- –í–≤–æ–¥ –ø–∞—Ä–æ–ª—è -->
                <div id="enterPassword">
                    <div style="padding:20px; background:var(--rolex-cream); border-radius:16px;">
                        <h4 style="margin-bottom:15px;">üîë –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</h4>
                        <div class="password-field">
                            <input type="password" id="docPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                            <button class="btn-rolex" onclick="checkPassword()" style="padding:14px 20px;">–û—Ç–∫—Ä—ã—Ç—å</button>
                        </div>
                        <div style="color: #B22222; font-size:13px; margin-top:10px;" id="passwordError"></div>
                    </div>
                </div>

                <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã (—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ) -->
                <div id="documentsUnlocked" style="display: none;">
                    <div style="margin-bottom:15px;">
                        <button class="btn-outline" onclick="addNewDocument()" style="margin-right:10px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                        <button class="btn-outline" onclick="lockDocuments()">üîí –ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                    <div id="docsList" style="margin-bottom:20px;"></div>
                    
                    <div style="padding:20px; background:var(--rolex-cream); border-radius:16px;">
                        <h4 style="margin-bottom:15px;">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h4>
                        <div class="password-field">
                            <input type="password" id="changePassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                            <button class="btn-rolex" onclick="changePassword()" style="padding:14px 20px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
        <div class="right-panel">
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="nav-rolex">
                <button class="nav-btn active" onclick="switchTab('main')">üè† –õ–µ–Ω—Ç–∞</button>
                <button class="nav-btn" onclick="switchTab('search')">üîç –ü–æ–∏—Å–∫</button>
                <button class="nav-btn" onclick="switchTab('wash')">üßº –ú–æ–π–∫–∞</button>
                <button class="nav-btn" onclick="switchTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            </div>

            <!-- –õ–ï–ù–¢–ê -->
            <div id="main" class="tab active">
                <div class="content-card">
                    <h2 style="margin-bottom:20px; color:var(--rolex-green);">üì∞ –õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π</h2>
                    <div class="search-results" id="historyList"></div>
                </div>
            </div>

            <!-- –ü–û–ò–°–ö -->
            <div id="search" class="tab">
                <div class="content-card">
                    <h2 style="margin-bottom:20px; color:var(--rolex-green);">üîç –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç</h2>
                    <input type="text" class="search-rolex" id="workSearch" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 1 –±—É–∫–≤—É..." oninput="searchWorks()">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>

            <!-- –ú–û–ô–ö–ê -->
            <div id="wash" class="tab">
                <div class="content-card">
                    <h2 style="margin-bottom:20px; color:var(--rolex-green);">üßº –ó–∞–ø–∏—Å—å –º–æ–π–∫–∏</h2>
                    
                    <div class="wash-form">
                        <input type="date" id="washDate" class="search-rolex" value="2026-02-27">
                        <input type="number" id="washMileage" class="search-rolex" placeholder="–ü—Ä–æ–±–µ–≥ (–∫–º)" value="45000">
                        
                        <select id="washType" class="search-rolex">
                            <option>üöø –†—É—á–Ω–∞—è –º–æ–π–∫–∞</option>
                            <option>üí® –ë–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è</option>
                            <option>üîÑ –°–∞–º–æ–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</option>
                            <option>‚ú® –•–∏–º—á–∏—Å—Ç–∫–∞ —Å–∞–ª–æ–Ω–∞</option>
                            <option>üß¥ –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∫—É–∑–æ–≤–∞</option>
                        </select>

                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="chem1" value="–®–∞–º–ø—É–Ω—å">
                                <label for="chem1">üß™ –®–∞–º–ø—É–Ω—å</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="chem2" value="–ê–∫—Ç–∏–≤–Ω–∞—è –ø–µ–Ω–∞">
                                <label for="chem2">üß™ –ê–∫—Ç–∏–≤–Ω–∞—è –ø–µ–Ω–∞</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="chem3" value="–í–æ—Å–∫">
                                <label for="chem3">üß™ –í–æ—Å–∫</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="chem4" value="–ê–Ω—Ç–∏–¥–æ–∂–¥—å">
                                <label for="chem4">üß™ –ê–Ω—Ç–∏–¥–æ–∂–¥—å</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="chem5" value="–û—á–∏—Å—Ç–∏—Ç–µ–ª—å –±–∏—Ç—É–º–∞">
                                <label for="chem5">üß™ –û—á–∏—Å—Ç–∏—Ç–µ–ª—å –±–∏—Ç—É–º–∞</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="chem6" value="–û—á–∏—Å—Ç–∏—Ç–µ–ª—å –¥–∏—Å–∫–æ–≤">
                                <label for="chem6">üß™ –û—á–∏—Å—Ç–∏—Ç–µ–ª—å –¥–∏—Å–∫–æ–≤</label>
                            </div>
                        </div>

                        <textarea id="washNotes" class="search-rolex" placeholder="–ó–∞–º–µ—Ç–∫–∏ –æ –º–æ–π–∫–µ..." rows="3"></textarea>

                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                            <div class="photo-upload" onclick="document.getElementById('washBefore').click()">
                                üì∏ –§–æ—Ç–æ –î–û (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                                <input type="file" id="washBefore" accept="image/*" style="display:none;" onchange="previewWashPhoto(this, 'before')">
                            </div>
                            <div class="photo-upload" onclick="document.getElementById('washAfter').click()">
                                üì∏ –§–æ—Ç–æ –ü–û–°–õ–ï (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                                <input type="file" id="washAfter" accept="image/*" style="display:none;" onchange="previewWashPhoto(this, 'after')">
                            </div>
                        </div>

                        <div class="wash-previews" id="washPreviews"></div>

                        <input type="number" id="washCost" class="search-rolex" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)" value="800">

                        <button class="btn-rolex" onclick="saveWash()" style="width:100%; padding:18px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–π–∫—É</button>
                    </div>
                </div>
            </div>

            <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            <div id="stats" class="tab">
                <div class="content-card">
                    <h2 style="margin-bottom:20px; color:var(--rolex-green);">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    
                    <div style="display:flex; justify-content:flex-end; margin-bottom:20px;">
                        <button class="btn-outline" onclick="resetStats()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
                    </div>
                    
                    <div style="max-width:400px; margin:0 auto;">
                        <canvas id="expenseChart"></canvas>
                    </div>

                    <div class="stats-grid" id="statsGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–ø—Ä–∞–≤–∫–∏ -->
    <div class="modal-overlay" id="fuelOverlay" onclick="closeFuelModal()"></div>
    <div class="modal-rolex" id="fuelModal">
        <h2 style="margin-bottom:20px; color:var(--rolex-green);">‚õΩ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–∞–≤–∫—É</h2>
        <div style="display:grid; gap:15px;">
            <input type="number" id="fuelCost" class="search-rolex" placeholder="–°—É–º–º–∞ (‚ÇΩ)" value="2000">
            <input type="number" id="fuelLiters" class="search-rolex" placeholder="–õ–∏—Ç—Ä–æ–≤" value="50">
            <input type="text" id="fuelType" class="search-rolex" placeholder="–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞" value="–ê–ò-95">
            <input type="number" id="fuelMileage" class="search-rolex" placeholder="–ü—Ä–æ–±–µ–≥" value="45000">
            <input type="date" id="fuelDate" class="search-rolex" value="2026-02-27">
            <button class="btn-rolex" onclick="saveFuel()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="btn-outline" onclick="closeFuelModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ -->
    <div class="modal-overlay" id="editCarOverlay" onclick="closeEditCarModal()"></div>
    <div class="modal-rolex" id="editCarModal">
        <h2 style="margin-bottom:20px; color:var(--rolex-green);">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ</h2>
        <div style="display:grid; gap:15px;">
            <input type="text" id="editPlate" class="search-rolex" placeholder="–ì–æ—Å–Ω–æ–º–µ—Ä" value="A 123 AA">
            <input type="text" id="editPlateRegion" class="search-rolex" placeholder="–†–µ–≥–∏–æ–Ω" value="77 RUS">
            <input type="text" id="editVin" class="search-rolex" placeholder="VIN" value="WBANX123456789012">
            <input type="text" id="editBrand" class="search-rolex" placeholder="–ú–∞—Ä–∫–∞" value="BMW">
            <input type="text" id="editModel" class="search-rolex" placeholder="–ú–æ–¥–µ–ª—å" value="X5">
            <input type="number" id="editYear" class="search-rolex" placeholder="–ì–æ–¥" value="2020">
            <input type="number" id="editMileage" class="search-rolex" placeholder="–¢–µ–∫—É—â–∏–π –ø—Ä–æ–±–µ–≥" value="45000">
            <input type="date" id="editPurchaseDate" class="search-rolex" value="2022-03-15">
            <input type="number" id="editPurchaseMileage" class="search-rolex" placeholder="–ü—Ä–æ–±–µ–≥ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ" value="20000">
            <button class="btn-rolex" onclick="saveCarData()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <script>
        // ===== –î–ê–ù–ù–´–ï =====
        let userData = {
            car: {
                plate: 'A 123 AA',
                plateRegion: '77 RUS',
                vin: 'WBANX123456789012',
                brand: 'BMW',
                model: 'X5',
                year: 2020,
                mileage: 45000,
                purchaseDate: '2022-03-15',
                purchaseMileage: 20000
            },
            documents: {
                hasPassword: false,
                password: '',
                items: [
                    { name: '–°–¢–°', expire: '01.01.2026' },
                    { name: '–ü–¢–°', expire: '–±–µ—Å—Å—Ä–æ—á–Ω–æ' },
                    { name: '–í–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∞', expire: '15.06.2026' },
                    { name: '–û–°–ê–ì–û', expire: '20.04.2026' },
                    { name: '–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞', expire: '10.08.2026' }
                ]
            },
            history: [],
            finances: { fuel: 0, repairs: 0, washes: 0, insurance: 0, taxes: 0 }
        };

        const WORK_CATALOG = [
            { name: "–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞ –≤ –¥–≤–∏–≥–∞—Ç–µ–ª–µ", price: 1500 },
            { name: "–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª—è–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞", price: 800 },
            { name: "–ó–∞–º–µ–Ω–∞ –≤–æ–∑–¥—É—à–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞", price: 600 },
            { name: "–ó–∞–º–µ–Ω–∞ —Å–∞–ª–æ–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞", price: 500 },
            { name: "–ó–∞–º–µ–Ω–∞ —Ç–æ–ø–ª–∏–≤–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞", price: 1200 },
            { name: "–ó–∞–º–µ–Ω–∞ —Ç–æ—Ä–º–æ–∑–Ω—ã—Ö –∫–æ–ª–æ–¥–æ–∫", price: 2000 },
            { name: "–ó–∞–º–µ–Ω–∞ —Ç–æ—Ä–º–æ–∑–Ω—ã—Ö –¥–∏—Å–∫–æ–≤", price: 2500 },
            { name: "–ó–∞–º–µ–Ω–∞ —Ç–æ—Ä–º–æ–∑–Ω–æ–π –∂–∏–¥–∫–æ—Å—Ç–∏", price: 1500 },
            { name: "–ó–∞–º–µ–Ω–∞ —Å–≤–µ—á–µ–π –∑–∞–∂–∏–≥–∞–Ω–∏—è", price: 800 },
            { name: "–ó–∞–º–µ–Ω–∞ —Ä–µ–º–Ω—è –ì–†–ú", price: 4000 },
            { name: "–ó–∞–º–µ–Ω–∞ –ø–æ–º–ø—ã", price: 3500 },
            { name: "–ó–∞–º–µ–Ω–∞ –∞–Ω—Ç–∏—Ñ—Ä–∏–∑–∞", price: 1200 },
            { name: "–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞ –≤ –ê–ö–ü–ü", price: 3500 },
            { name: "–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞ –≤ –ú–ö–ü–ü", price: 1200 },
            { name: "–ó–∞–º–µ–Ω–∞ —Å–∞–π–ª–µ–Ω—Ç–±–ª–æ–∫–æ–≤", price: 1500 },
            { name: "–ó–∞–º–µ–Ω–∞ —à–∞—Ä–æ–≤—ã—Ö –æ–ø–æ—Ä", price: 1500 },
            { name: "–ó–∞–º–µ–Ω–∞ —Å—Ç–æ–µ–∫ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä–∞", price: 1000 },
            { name: "–ó–∞–º–µ–Ω–∞ –∞–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤", price: 2500 },
            { name: "–°—Ö–æ–¥-—Ä–∞–∑–≤–∞–ª", price: 2000 },
            { name: "–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∫–æ–ª–µ—Å", price: 800 },
            { name: "–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂", price: 2500 },
            { name: "–†–µ–º–æ–Ω—Ç –ø—Ä–æ–∫–æ–ª–∞", price: 800 },
            { name: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è", price: 1500 },
            { name: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–≤–µ—Å–∫–∏", price: 1000 },
            { name: "–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", price: 1500 },
            { name: "–ß–∏—Å—Ç–∫–∞ —Ñ–æ—Ä—Å—É–Ω–æ–∫", price: 3000 },
            { name: "–ü–æ–ª–∏—Ä–æ–≤–∫–∞ —Ñ–∞—Ä", price: 2000 },
            { name: "–ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∫—É–∑–æ–≤–∞", price: 8000 },
            { name: "–•–∏–º—á–∏—Å—Ç–∫–∞ —Å–∞–ª–æ–Ω–∞", price: 5000 },
            { name: "–ú–æ–π–∫–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è", price: 3000 }
        ];

        // ===== –ü–û–ì–û–î–ê =====
        async function loadWeather() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                const city = data.city || '–ú–æ—Å–∫–≤–∞';
                document.getElementById('weatherCity').textContent = city;
                
                // –Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞ (–∏–º–∏—Ç–∞—Ü–∏—è –¥–ª—è –¥–µ–º–æ)
                const temp = Math.floor(Math.random() * 20) + 5;
                const conditions = ['‚òÄÔ∏è', '‚õÖ', 'üåßÔ∏è', '‚ùÑÔ∏è'];
                const condition = conditions[Math.floor(Math.random() * conditions.length)];
                
                document.getElementById('weatherIcon').textContent = condition;
                document.getElementById('weatherTemp').textContent = `+${temp}¬∞C`;
                
                const advice = document.getElementById('weatherAdvice');
                if (condition === 'üåßÔ∏è') {
                    advice.innerHTML = 'üåßÔ∏è –°–µ–≥–æ–¥–Ω—è –¥–æ–∂–¥—å. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ—Ç–ª–æ–∂–∏—Ç—å –º–æ–π–∫—É';
                } else if (condition === '‚ùÑÔ∏è') {
                    advice.innerHTML = '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä';
                } else if (temp > 20) {
                    advice.innerHTML = '‚òÄÔ∏è –¢–µ–ø–ª–æ. –û—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —É—Ö–æ–¥–∞ –∑–∞ –∞–≤—Ç–æ';
                } else {
                    advice.innerHTML = '‚úÖ –ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è';
                }
            } catch (e) {
                console.log('Weather error:', e);
            }
        }

        // ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø =====
        function showNotification(message, type = 'info', details = '') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = type === 'fuel' ? '‚õΩ' : type === 'wash' ? 'üßº' : '‚úÖ';
            
            notification.innerHTML = `
                <div style="font-size:24px;">${icon}</div>
                <div>
                    <div style="font-weight:600;">${message}</div>
                    ${details ? `<div style="font-size:12px; color:#666;">${details}</div>` : ''}
                </div>
                <button onclick="this.parentElement.remove()" style="margin-left:auto; background:none; border:none; font-size:20px; cursor:pointer;">‚úï</button>
            `;
            
            container.appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        // ===== –ê–í–¢–û =====
        function updateCarInfo() {
            document.getElementById('carInfo').innerHTML = `
                <div class="spec-card">
                    <div class="spec-label">–ì–æ—Å–Ω–æ–º–µ—Ä</div>
                    <div class="spec-value">${userData.car.plate}</div>
                </div>
                <div class="spec-card">
                    <div class="spec-label">–†–µ–≥–∏–æ–Ω</div>
                    <div class="spec-value">${userData.car.plateRegion}</div>
                </div>
                <div class="spec-card">
                    <div class="spec-label">–ú–∞—Ä–∫–∞</div>
                    <div class="spec-value">${userData.car.brand}</div>
                </div>
                <div class="spec-card">
                    <div class="spec-label">–ú–æ–¥–µ–ª—å</div>
                    <div class="spec-value">${userData.car.model}</div>
                </div>
                <div class="spec-card">
                    <div class="spec-label">–ì–æ–¥</div>
                    <div class="spec-value">${userData.car.year}</div>
                </div>
                <div class="spec-card">
                    <div class="spec-label">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–±–µ–≥</div>
                    <div class="spec-value">${userData.car.mileage.toLocaleString()} –∫–º</div>
                </div>
                <div class="spec-card">
                    <div class="spec-label">–ü–æ–∫—É–ø–∫–∞</div>
                    <div class="spec-value">${new Date(userData.car.purchaseDate).toLocaleDateString('ru-RU')}</div>
                </div>
                <div class="spec-card">
                    <div class="spec-label">–ü—Ä–æ–±–µ–≥ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ</div>
                    <div class="spec-value">${userData.car.purchaseMileage.toLocaleString()} –∫–º</div>
                </div>
            `;
            
            document.getElementById('vinNumber').textContent = userData.car.vin;
        }

        // ===== –î–û–ö–£–ú–ï–ù–¢–´ =====
        function initDocuments() {
            if (userData.documents.hasPassword) {
                document.getElementById('enterPassword').style.display = 'block';
                document.getElementById('noPassword').style.display = 'none';
            } else {
                document.getElementById('enterPassword').style.display = 'none';
                document.getElementById('noPassword').style.display = 'block';
            }
            document.getElementById('documentsUnlocked').style.display = 'none';
            document.getElementById('docStatus').textContent = '(–∑–∞–∫—Ä—ã—Ç–æ)';
        }

        function createPassword() {
            const pass = document.getElementById('newPassword').value;
            if (pass) {
                userData.documents.password = pass;
                userData.documents.hasPassword = true;
                saveToStorage();
                showNotification('‚úÖ –ü–∞—Ä–æ–ª—å —Å–æ–∑–¥–∞–Ω', 'success');
                initDocuments();
            }
        }

        function checkPassword() {
            const pass = document.getElementById('docPassword').value;
            if (pass === userData.documents.password) {
                document.getElementById('enterPassword').style.display = 'none';
                document.getElementById('noPassword').style.display = 'none';
                document.getElementById('documentsUnlocked').style.display = 'block';
                document.getElementById('docStatus').textContent = '(–æ—Ç–∫—Ä—ã—Ç–æ)';
                document.getElementById('passwordError').textContent = '';
                loadDocsList();
            } else {
                document.getElementById('passwordError').textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                document.getElementById('docPassword').value = '';
            }
        }

        function lockDocuments() {
            document.getElementById('enterPassword').style.display = 'block';
            document.getElementById('documentsUnlocked').style.display = 'none';
            document.getElementById('docStatus').textContent = '(–∑–∞–∫—Ä—ã—Ç–æ)';
        }

        function loadDocsList() {
            const list = document.getElementById('docsList');
            list.innerHTML = userData.documents.items.map((doc, index) => `
                <div class="doc-item">
                    <span>üìÑ ${doc.name} ‚Äî ${doc.expire}</span>
                    <div class="doc-actions">
                        <button onclick="editDocument(${index})">‚úèÔ∏è</button>
                        <button onclick="deleteDocument(${index})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function editDocument(index) {
            const newExpire = prompt('–ù–æ–≤—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:', userData.documents.items[index].expire);
            if (newExpire) {
                userData.documents.items[index].expire = newExpire;
                saveToStorage();
                loadDocsList();
                showNotification('‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω', 'success');
            }
        }

        function deleteDocument(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç?')) {
                userData.documents.items.splice(index, 1);
                saveToStorage();
                loadDocsList();
                showNotification('‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª—ë–Ω', 'success');
            }
        }

        function addNewDocument() {
            const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:');
            const expire = prompt('–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:');
            if (name) {
                userData.documents.items.push({ name, expire: expire || '–±–µ—Å—Å—Ä–æ—á–Ω–æ' });
                saveToStorage();
                loadDocsList();
                showNotification('‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            }
        }

        function changePassword() {
            const newPass = document.getElementById('changePassword').value;
            if (newPass) {
                userData.documents.password = newPass;
                saveToStorage();
                showNotification('‚úÖ –ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω', 'success');
                document.getElementById('changePassword').value = '';
            }
        }

        // ===== –ó–ê–ü–†–ê–í–ö–ê =====
        function openFuelModal() {
            document.getElementById('fuelModal').classList.add('active');
            document.getElementById('fuelOverlay').style.display = 'block';
        }

        function closeFuelModal() {
            document.getElementById('fuelModal').classList.remove('active');
            document.getElementById('fuelOverlay').style.display = 'none';
        }

        function saveFuel() {
            const cost = parseInt(document.getElementById('fuelCost').value);
            const liters = document.getElementById('fuelLiters').value;
            const type = document.getElementById('fuelType').value;
            const mileage = parseInt(document.getElementById('fuelMileage').value);
            const date = document.getElementById('fuelDate').value;

            const record = {
                id: Date.now(),
                date,
                type: 'fuel',
                title: '–ó–∞–ø—Ä–∞–≤–∫–∞',
                details: `${type} ‚Ä¢ ${liters} –ª`,
                mileage,
                cost
            };

            userData.history.unshift(record);
            userData.finances.fuel += cost;
            saveToStorage();
            loadHistory();
            closeFuelModal();
            
            showNotification('‚õΩ –ó–∞–ø—Ä–∞–≤–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'fuel', `${type} ‚Ä¢ ${liters} –ª ‚Ä¢ ${cost} ‚ÇΩ`);
        }

        // ===== –ü–û–ò–°–ö =====
        function searchWorks() {
            const search = document.getElementById('workSearch').value.toLowerCase();
            const results = document.getElementById('searchResults');
            
            if (search.length < 1) {
                results.innerHTML = '<div style="color:#999; text-align:center;">–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 1 —Å–∏–º–≤–æ–ª</div>';
                return;
            }
            
            const filtered = WORK_CATALOG.filter(w => 
                w.name.toLowerCase().includes(search)
            ).slice(0, 10);
            
            if (filtered.length === 0) {
                results.innerHTML = '<div style="color:#999; text-align:center;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                return;
            }
            
            results.innerHTML = filtered.map(w => `
                <div class="search-result-item" onclick="addWork('${w.name.replace(/'/g, "\\'")}', ${w.price})">
                    <div style="display:flex; justify-content:space-between;">
                        <span>${w.name}</span>
                        <span style="color:var(--rolex-gold);">${w.price.toLocaleString()} ‚ÇΩ</span>
                    </div>
                </div>
            `).join('');
        }

        function addWork(name, price) {
            const date = prompt('–î–∞—Ç–∞:', new Date().toISOString().split('T')[0]);
            const mileage = prompt('–ü—Ä–æ–±–µ–≥:', userData.car.mileage);
            
            if (date && mileage) {
                userData.history.unshift({
                    id: Date.now(),
                    date,
                    type: 'repair',
                    title: name,
                    mileage: parseInt(mileage),
                    cost: price
                });
                userData.finances.repairs += price;
                saveToStorage();
                loadHistory();
                showNotification('‚úÖ –†–∞–±–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success', `${name} ‚Ä¢ ${price} ‚ÇΩ`);
            }
        }

        // ===== –ò–°–¢–û–†–ò–Ø =====
        function loadHistory() {
            const list = document.getElementById('historyList');
            if (userData.history.length === 0) {
                list.innerHTML = '<div style="color:#999; text-align:center; padding:40px;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
                return;
            }
            
            list.innerHTML = userData.history.map(item => `
                <div class="search-result-item">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <span style="font-size:24px;">${item.type === 'fuel' ? '‚õΩ' : item.type === 'repair' ? 'üîß' : 'üßº'}</span>
                        <div style="flex:1;">
                            <div style="display:flex; justify-content:space-between;">
                                <span class="history-date">${new Date(item.date).toLocaleDateString('ru-RU')}</span>
                                <span class="history-mileage">${item.mileage.toLocaleString()} –∫–º</span>
                            </div>
                            <div style="font-weight:600;">${item.title}</div>
                            ${item.details ? `<div style="font-size:12px; color:#666;">${item.details}</div>` : ''}
                        </div>
                        <div style="font-weight:700; color:var(--rolex-green);">${item.cost.toLocaleString()} ‚ÇΩ</div>
                        <button onclick="deleteHistoryItem(${item.id})" style="background:none; border:none; font-size:18px; cursor:pointer;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteHistoryItem(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
                userData.history = userData.history.filter(i => i.id !== id);
                saveToStorage();
                loadHistory();
                showNotification('‚úÖ –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞', 'success');
            }
        }

        // ===== –ú–û–ô–ö–ê =====
        function previewWashPhoto(input, type) {
            if (input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previews = document.getElementById('washPreviews');
                    const div = document.createElement('div');
                    div.innerHTML = `<img src="${e.target.result}" style="width:100%; aspect-ratio:1; object-fit:cover; border-radius:12px;">`;
                    previews.appendChild(div);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveWash() {
            const date = document.getElementById('washDate').value;
            const mileage = document.getElementById('washMileage').value;
            const type = document.getElementById('washType').value;
            const notes = document.getElementById('washNotes').value;
            const cost = parseInt(document.getElementById('washCost').value);
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ö–∏–º–∏—é
            const chemicals = [];
            document.querySelectorAll('.checkbox-group input:checked').forEach(cb => {
                chemicals.push(cb.value);
            });
            
            const chemicalsText = chemicals.length > 0 ? ` ‚Ä¢ ${chemicals.join(', ')}` : '';

            const record = {
                id: Date.now(),
                date,
                type: 'wash',
                title: '–ú–æ–π–∫–∞',
                details: `${type}${chemicalsText}${notes ? ' ‚Ä¢ ' + notes : ''}`,
                mileage: parseInt(mileage),
                cost
            };

            userData.history.unshift(record);
            userData.finances.washes += cost;
            saveToStorage();
            loadHistory();
            
            showNotification('üßº –ú–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'wash', `${type} ‚Ä¢ ${cost} ‚ÇΩ`);
            
            // –û—á–∏—Å—Ç–∫–∞
            document.getElementById('washBefore').value = '';
            document.getElementById('washAfter').value = '';
            document.getElementById('washPreviews').innerHTML = '';
            document.getElementById('washNotes').value = '';
            document.querySelectorAll('.checkbox-group input').forEach(cb => cb.checked = false);
        }

        // ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê =====
        let chart = null;

        function initChart() {
            const ctx = document.getElementById('expenseChart')?.getContext('2d');
            if (!ctx) return;
            
            if (chart) chart.destroy();
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['–¢–æ–ø–ª–∏–≤–æ', '–†–µ–º–æ–Ω—Ç', '–ú–æ–π–∫–∏', '–°—Ç—Ä–∞—Ö–æ–≤–∫–∏', '–ù–∞–ª–æ–≥–∏'],
                    datasets: [{
                        data: [
                            userData.finances.fuel,
                            userData.finances.repairs,
                            userData.finances.washes,
                            userData.finances.insurance,
                            userData.finances.taxes
                        ],
                        backgroundColor: ['#006039', '#956B3E', '#C0C0C0', '#1B3B6A', '#4A4A4A'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#333' } }
                    },
                    cutout: '60%'
                }
            });

            const total = userData.finances.fuel + userData.finances.repairs + userData.finances.washes + 
                         userData.finances.insurance + userData.finances.taxes;

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤</div>
                    <div class="stat-value">${total.toLocaleString()} ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å 1 –∫–º</div>
                    <div class="stat-value">${(total / userData.car.mileage).toFixed(2)} ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ü—Ä–æ–±–µ–≥</div>
                    <div class="stat-value">${userData.car.mileage.toLocaleString()} –∫–º</div>
                </div>
            `;
        }

        function resetStats() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?')) {
                userData.finances = { fuel: 0, repairs: 0, washes: 0, insurance: 0, taxes: 0 };
                userData.history = [];
                saveToStorage();
                loadHistory();
                initChart();
                showNotification('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞', 'success');
            }
        }

        // ===== –ê–í–¢–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï =====
        function openEditCarModal() {
            document.getElementById('editPlate').value = userData.car.plate;
            document.getElementById('editPlateRegion').value = userData.car.plateRegion;
            document.getElementById('editVin').value = userData.car.vin;
            document.getElementById('editBrand').value = userData.car.brand;
            document.getElementById('editModel').value = userData.car.model;
            document.getElementById('editYear').value = userData.car.year;
            document.getElementById('editMileage').value = userData.car.mileage;
            document.getElementById('editPurchaseDate').value = userData.car.purchaseDate;
            document.getElementById('editPurchaseMileage').value = userData.car.purchaseMileage;
            
            document.getElementById('editCarModal').classList.add('active');
            document.getElementById('editCarOverlay').style.display = 'block';
        }

        function closeEditCarModal() {
            document.getElementById('editCarModal').classList.remove('active');
            document.getElementById('editCarOverlay').style.display = 'none';
        }

        function saveCarData() {
            userData.car = {
                plate: document.getElementById('editPlate').value,
                plateRegion: document.getElementById('editPlateRegion').value,
                vin: document.getElementById('editVin').value,
                brand: document.getElementById('editBrand').value,
                model: document.getElementById('editModel').value,
                year: parseInt(document.getElementById('editYear').value),
                mileage: parseInt(document.getElementById('editMileage').value),
                purchaseDate: document.getElementById('editPurchaseDate').value,
                purchaseMileage: parseInt(document.getElementById('editPurchaseMileage').value)
            };
            
            saveToStorage();
            updateCarInfo();
            closeEditCarModal();
            showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
        }

        // ===== –û–ë–©–ï–ï =====
        function saveToStorage() {
            localStorage.setItem('drivePremium', JSON.stringify(userData));
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('drivePremium');
            if (saved) {
                userData = JSON.parse(saved);
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tabName === 'stats') initChart();
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–ø—Ä–∞–≤–∫–∏ –≤ –ª–µ–≤—É—é –ø–∞–Ω–µ–ª—å
        function addFuelButton() {
            const leftPanel = document.querySelector('.left-panel');
            const fuelBtn = document.createElement('button');
            fuelBtn.className = 'btn-rolex';
            fuelBtn.innerHTML = '<span style="margin-right:10px;">‚õΩ</span> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–∞–≤–∫—É';
            fuelBtn.onclick = openFuelModal;
            fuelBtn.style.marginTop = '10px';
            leftPanel.appendChild(fuelBtn);
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        document.addEventListener('DOMContentLoaded', () => {
            loadFromStorage();
            updateCarInfo();
            loadWeather();
            loadHistory();
            initDocuments();
            addFuelButton();
            
            setInterval(loadWeather, 1800000);
        });
    </script>
</body>
</html>
